<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Metakit: c4_Storage Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>c4_Storage Class Reference</h1><!-- doxytag: class=<c4_Storage> --><!-- doxytag: inherits=<c4_View> -->Manager for persistent storage of view structures.  
<a href="#_details">More...</a>
<p>
Inheritance diagram for c4_Storage:<p><center><img src="classc4___storage__inherit__graph.png" border="0" usemap="#c4___storage__inherit__map" alt="Inheritance graph"></center>
<map name="c4___storage__inherit__map">
<area href="classc4___view.html" shape="rect" coords="16,9,88,33" alt="">
</map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center><a href="classc4___storage-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0"></a><!-- doxytag: member=<c4_Storage::c4_Storage> ref=<a0> args=<()> -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a0">c4_Storage</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct streaming-only storage object. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a1"></a><!-- doxytag: member=<c4_Storage::c4_Storage> ref=<a1> args=<(c4_Strategy &amp;, bool=false, int=1)> -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a1">c4_Storage</a> (<a class="el" href="classc4___strategy.html">c4_Strategy</a> &amp;, bool=false, int=1)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct a storage using the specified strategy handler. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a2"></a><!-- doxytag: member=<c4_Storage::c4_Storage> ref=<a2> args=<(const char *, int)> -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a2">c4_Storage</a> (const char *, int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct a storage object, keeping the current structure. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a3"></a><!-- doxytag: member=<c4_Storage::c4_Storage> ref=<a3> args=<(const c4_View &amp;)> -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a3">c4_Storage</a> (const <a class="el" href="classc4___view.html">c4_View</a> &amp;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reconstruct a storage object from a suitable view. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a4"></a><!-- doxytag: member=<c4_Storage::~c4_Storage> ref=<a4> args=<()> -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a4">~c4_Storage</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destructor, usually closes file, but does not commit by default. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a5"></a><!-- doxytag: member=<c4_Storage::SetStructure> ref=<a5> args=<(const char *)> -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a5">SetStructure</a> (const char *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define the complete view structure of the storage. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a6"></a><!-- doxytag: member=<c4_Storage::AutoCommit> ref=<a6> args=<(bool=true)> -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a6">AutoCommit</a> (bool=true)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set storage up to always call Commit in the destructor. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a7"></a><!-- doxytag: member=<c4_Storage::Strategy> ref=<a7> args=<() const > -->
<a class="el" href="classc4___strategy.html">c4_Strategy</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a7">Strategy</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the strategy object associated with this storage. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a8"></a><!-- doxytag: member=<c4_Storage::Description> ref=<a8> args=<(const char *=0)> -->
const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a8">Description</a> (const char *=0)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a description of the view structure (default is all). <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a9"></a><!-- doxytag: member=<c4_Storage::SetAside> ref=<a9> args=<(c4_Storage &amp;)> -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a9">SetAside</a> (<a class="el" href="classc4___storage.html">c4_Storage</a> &amp;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define the storage to use for differential commits. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a10"></a><!-- doxytag: member=<c4_Storage::GetAside> ref=<a10> args=<() const > -->
<a class="el" href="classc4___storage.html">c4_Storage</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a10">GetAside</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return storage used for differential commits, or null. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a11"></a><!-- doxytag: member=<c4_Storage::Commit> ref=<a11> args=<(bool=false)> -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a11">Commit</a> (bool=false)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flush pending changes to file right now. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a12">Rollback</a> (bool=false)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">(Re)initialize for on-demand loading  <a href="#a12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a13"></a><!-- doxytag: member=<c4_Storage::View> ref=<a13> args=<(const char *)> -->
<a class="el" href="classc4___view_ref.html">c4_ViewRef</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a13">View</a> (const char *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get or set a named view in this storage object. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a14"></a><!-- doxytag: member=<c4_Storage::GetAs> ref=<a14> args=<(const char *)> -->
<a class="el" href="classc4___view.html">c4_View</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a14">GetAs</a> (const char *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a named view, redefining it to match the given structure. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a15"></a><!-- doxytag: member=<c4_Storage::LoadFrom> ref=<a15> args=<(c4_Stream &amp;)> -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a15">LoadFrom</a> (<a class="el" href="classc4___stream.html">c4_Stream</a> &amp;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load contents from the specified input stream. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a16"></a><!-- doxytag: member=<c4_Storage::SaveTo> ref=<a16> args=<(c4_Stream &amp;)> -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classc4___storage.html#a16">SaveTo</a> (<a class="el" href="classc4___stream.html">c4_Stream</a> &amp;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Save contents to the specified output stream. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Manager for persistent storage of view structures. 
<p>
The storage class uses a view, with additional functionality to be able to store and reload the data it contains (including nested subviews).<p>
By default, data is loaded on demand, i.e. whenever data which has not yet been referenced is used for the first time. Loading is limited to the lifetime of this storage object, since the storage object carries the file descriptor with it that is needed to access the data file.<p>
To save changes, call the Commit member. This is the only time that data is written to file - when using a read-only file simply avoid calling Commit.<p>
The LoadFromStream and SaveToStream members can be used to serialize the contents of this storage row using only sequential I/O (no seeking, only read or write calls).<p>
The data storage mechanism implementation provides fail-safe operation: if anything prevents Commit from completing its task, the last succesfully committed version of the saved data will be recovered on the next open. This also includes changes made to the table structure.<p>
The following code creates a view with 1 row and stores it on file: <div class="fragment"><pre class="fragment">    <a class="code" href="classc4___string_prop.html">c4_StringProp</a> pName (<span class="stringliteral">"Name"</span>);
    <a class="code" href="classc4___int_prop.html">c4_IntProp</a> pAge (<span class="stringliteral">"Age"</span>);

    <a class="code" href="classc4___storage.html">c4_Storage</a> storage (<span class="stringliteral">"myfile.dat"</span>, <span class="keyword">true</span>);
    <a class="code" href="classc4___view.html">c4_View</a> myView = storage.GetAs(<span class="stringliteral">"Musicians[Name:S,Age:I]"</span>);

    myView.<a class="code" href="classc4___view.html#a18">Add</a>(pName [<span class="stringliteral">"John Williams"</span>] + pAge [43]);

    storage.Commit();
</pre></div>
<p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a12"></a><!-- doxytag: member=<c4_Storage::Rollback> ref=<a12> args=<(bool=false)> --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool c4_Storage::Rollback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">bool&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>full_</em> = <code>false</code>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
(Re)initialize for on-demand loading 
<p>
Calling Rollback will cancel all uncommitted changes.    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="mk4_8h-source.html">mk4.h</a><li><a class="el" href="store_8cpp.html">store.cpp</a></ul>
<br><hr size=1>
<center>
    Metakit C++ API Reference -
    <a href="http://www.equi4.com/metakit.html">http://www.equi4.com/metakit.html</a>
    - extracted with
    <a href="http://www.doxygen.org">Doxygen</a>
</center>
</body></html>
