<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Metakit: persist.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>persist.h</h1><a href="persist_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// persist.h --</span>
<a name="l00002"></a>00002 <span class="comment">// $Id: persist.h,v 1.14 2004/01/28 21:33:40 jcw Exp $</span>
<a name="l00003"></a>00003 <span class="comment">// This is part of Metakit, see http://www.equi4.com/metakit/</span>
<a name="l00004"></a>00004 
<a name="l00009"></a>00009 <span class="preprocessor">#ifndef __PERSIST_H__</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#define __PERSIST_H__</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00013"></a>00013 <span class="comment">// Declarations in this file</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015   <span class="keyword">class </span>c4_SaveContext;       <span class="comment">// wraps file commits</span>
<a name="l00016"></a>00016   <span class="keyword">class </span>c4_Persist;         <span class="comment">// persistent table storage</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018   <span class="keyword">class </span>c4_Allocator;         <span class="comment">// not defined here</span>
<a name="l00019"></a>00019   <span class="keyword">class </span>c4_Column;          <span class="comment">// not defined here</span>
<a name="l00020"></a>00020   <span class="keyword">class </span>c4_Differ;          <span class="comment">// not defined here</span>
<a name="l00021"></a>00021   <span class="keyword">class </span>c4_FileMark;          <span class="comment">// not defined here</span>
<a name="l00022"></a>00022   <span class="keyword">class </span><a class="code" href="classc4___strategy.html">c4_Strategy</a>;          <span class="comment">// not defined here</span>
<a name="l00023"></a>00023   <span class="keyword">class </span>c4_HandlerSeq;        <span class="comment">// not defined here</span>
<a name="l00024"></a>00024 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">class </span>c4_SaveContext
<a name="l00028"></a>00028 { 
<a name="l00029"></a>00029   <a class="code" href="classc4___strategy.html">c4_Strategy</a>&amp; _strategy;
<a name="l00030"></a>00030   c4_Column* _walk;
<a name="l00031"></a>00031   c4_Differ* _differ;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033   c4_Allocator* _space;
<a name="l00034"></a>00034   c4_Allocator* _cleanup;
<a name="l00035"></a>00035   c4_Allocator* _nextSpace;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037   <span class="keywordtype">bool</span> _preflight;
<a name="l00038"></a>00038   <span class="keywordtype">bool</span> _fullScan;
<a name="l00039"></a>00039   <span class="keywordtype">int</span> _mode;
<a name="l00040"></a>00040   
<a name="l00041"></a>00041   c4_DWordArray _newPositions;
<a name="l00042"></a>00042   <span class="keywordtype">int</span> _nextPosIndex;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   t4_byte* _bufPtr;
<a name="l00045"></a>00045   t4_byte* _curr;
<a name="l00046"></a>00046   t4_byte* _limit;
<a name="l00047"></a>00047   t4_byte _buffer [512];
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keyword">public</span>:           
<a name="l00050"></a>00050   c4_SaveContext (<a class="code" href="classc4___strategy.html">c4_Strategy</a>&amp; strategy_, <span class="keywordtype">bool</span> fullScan_, <span class="keywordtype">int</span> mode_,
<a name="l00051"></a>00051             c4_Differ* differ_, c4_Allocator* space_);
<a name="l00052"></a>00052   ~c4_SaveContext ();
<a name="l00053"></a>00053   
<a name="l00054"></a>00054   <span class="keywordtype">void</span> SaveIt(c4_HandlerSeq&amp; root_, c4_Allocator** spacePtr_,
<a name="l00055"></a>00055             <a class="code" href="classc4___bytes.html">c4_Bytes</a>&amp; rootWalk_);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="keywordtype">void</span> StoreValue(t4_i32 v_);
<a name="l00058"></a>00058   <span class="keywordtype">bool</span> CommitColumn(c4_Column&amp; col_);
<a name="l00059"></a>00059   <span class="keywordtype">void</span> CommitSequence(c4_HandlerSeq&amp; seq_, <span class="keywordtype">bool</span> selfDesc_);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   c4_Column* SetWalkBuffer(c4_Column* walk_);
<a name="l00062"></a>00062   <span class="keywordtype">bool</span> IsFlipped() <span class="keyword">const</span>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="keywordtype">bool</span> Serializing() <span class="keyword">const</span>;
<a name="l00065"></a>00065   <span class="keywordtype">void</span> AllocDump(<span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keywordtype">bool</span> =<span class="keyword">false</span>);
<a name="l00066"></a>00066   
<a name="l00067"></a>00067 <span class="keyword">private</span>:
<a name="l00068"></a>00068   <span class="keywordtype">void</span> FlushBuffer();
<a name="l00069"></a>00069   <span class="keywordtype">void</span> Write(<span class="keyword">const</span> <span class="keywordtype">void</span>* buf_, <span class="keywordtype">int</span> len_);
<a name="l00070"></a>00070 };
<a name="l00071"></a>00071 
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="keyword">class </span>c4_Persist
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076   c4_Allocator* _space;
<a name="l00077"></a>00077   <a class="code" href="classc4___strategy.html">c4_Strategy</a>&amp; _strategy;
<a name="l00078"></a>00078   c4_HandlerSeq* _root;
<a name="l00079"></a>00079   c4_Differ* _differ;
<a name="l00080"></a>00080   <a class="code" href="classc4___bytes.html">c4_Bytes</a> _rootWalk;
<a name="l00081"></a>00081   bool (c4_Persist::*_fCommit) (bool);
<a name="l00082"></a>00082   <span class="keywordtype">int</span> _mode;
<a name="l00083"></a>00083   <span class="keywordtype">bool</span> _owned;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="comment">// used for on-the-fly conversion of old-format datafiles</span>
<a name="l00086"></a>00086   t4_byte* _oldBuf;
<a name="l00087"></a>00087   <span class="keyword">const</span> t4_byte* _oldCurr;
<a name="l00088"></a>00088   <span class="keyword">const</span> t4_byte* _oldLimit;
<a name="l00089"></a>00089   t4_i32 _oldSeek;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="keywordtype">int</span> OldRead(t4_byte* buf_, <span class="keywordtype">int</span> len_);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="keyword">public</span>:
<a name="l00094"></a>00094   c4_Persist (<a class="code" href="classc4___strategy.html">c4_Strategy</a>&amp;, <span class="keywordtype">bool</span> owned_, <span class="keywordtype">int</span> mode_);
<a name="l00095"></a>00095   ~c4_Persist ();
<a name="l00096"></a>00096   
<a name="l00097"></a>00097   c4_HandlerSeq&amp; Root() <span class="keyword">const</span>;
<a name="l00098"></a>00098   <span class="keywordtype">void</span> SetRoot(c4_HandlerSeq* root_);
<a name="l00099"></a>00099   <a class="code" href="classc4___strategy.html">c4_Strategy</a>&amp; Strategy() <span class="keyword">const</span>;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="keywordtype">bool</span> AutoCommit(<span class="keywordtype">bool</span> =<span class="keyword">true</span>);
<a name="l00102"></a>00102   <span class="keywordtype">void</span> DoAutoCommit();
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   <span class="keywordtype">bool</span> SetAside(<a class="code" href="classc4___storage.html">c4_Storage</a>&amp; aside_);
<a name="l00105"></a>00105   <a class="code" href="classc4___storage.html">c4_Storage</a>* GetAside() <span class="keyword">const</span>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="keywordtype">bool</span> Commit(<span class="keywordtype">bool</span> full_);
<a name="l00108"></a>00108   <span class="keywordtype">bool</span> Rollback(<span class="keywordtype">bool</span> full_);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   <span class="keywordtype">bool</span> LoadIt(c4_Column&amp; walk_);
<a name="l00111"></a>00111   <span class="keywordtype">void</span> LoadAll();
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   t4_i32 LookupAside(<span class="keywordtype">int</span> id_);
<a name="l00114"></a>00114   <span class="keywordtype">void</span> ApplyAside(<span class="keywordtype">int</span> id_, c4_Column&amp; col_);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <span class="keywordtype">void</span> OccupySpace(t4_i32 pos_, t4_i32 len_);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   t4_i32 FetchOldValue();
<a name="l00119"></a>00119   <span class="keywordtype">void</span> FetchOldLocation(c4_Column&amp; col_);
<a name="l00120"></a>00120   
<a name="l00121"></a>00121   t4_i32 FreeBytes(t4_i32* bytes_ =0);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keyword">static</span> c4_HandlerSeq* Load(<a class="code" href="classc4___stream.html">c4_Stream</a>*);
<a name="l00124"></a>00124   <span class="keyword">static</span> <span class="keywordtype">void</span> Save(<a class="code" href="classc4___stream.html">c4_Stream</a>*, c4_HandlerSeq&amp; root_);
<a name="l00125"></a>00125 };
<a name="l00126"></a>00126 
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="preprocessor">#endif</span>
</pre></div><br><hr size=1>
<center>
    Metakit C++ API Reference -
    <a href="http://www.equi4.com/metakit.html">http://www.equi4.com/metakit.html</a>
    - extracted with
    <a href="http://www.doxygen.org">Doxygen</a>
</center>
</body></html>
